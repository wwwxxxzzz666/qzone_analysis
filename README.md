## 简介


本项目基于python语言，在使用了各类库和模块的基础上实现了一个对QQ空间内说说内容的抓取并进行自然语言分析的程序。其特性包括：

	使用selenium中的webdriver来模拟QQ空间的web端登录操作并获取cookies；

	使用获取得到的cookies来对QQ空间进行访问和数据的抓取；

	获取与打印QQ好友的名单，保存好友的QQ号和昵称数据并写入文件保存；

	抓取好友空间内所有说说的文字内容、发布时间等信息并写入文件保存；

	抓取指定QQ号的空间说说内容并分析；

	对抓取到的说说文字内容进行自然语言分析和处理，并写入结果至文件保存；

	使用jiagu、jieba对说说内容进行关键词提取；

	使用jiagu、snownlp对说说内容进行情感分析与统计；

	使用snownlp对说说内容进行概括提取；

	使用jieba、wordcloud对说说内容进行分词处理并生成可视化的词云图；

	使用threadpool线程池对好友列表所有的空间说说内容进行爬取和处理；

	……


## 使用说明


正常使用时，请注意先检查网络状态，再进入项目目录，运行python qzone.py即可。

如果为初次运行本程序，请注意你需要事先检查和准备的事项：

	安装python（本项目的测试环境版本为3.9.2），在项目目录内运行pip install -r requirements.txt。

	安装Microsoft Edge最新版，并在Microsoft Edge Driver - Microsoft Edge Developer页面内下载对应的webdriver程序，将下载得到的exe程序改名为msedgedriver.exe，并放至项目目录内。

	检查项目目录内是否有setting.ini和mask.jpg文件，若没有可以重新获取本项目，或者可以自行尝试创建。其中setting.ini可以删除后运行项目重新创建，mask.jpg可以没有。这两个文件的说明可见下。

	setting.ini为项目运行配置文件，以utf-8格式编辑、保存和查看，内有7行，分别依次为登录的QQ号，登录的QQ密码，单个空间爬取说说条数的最大值（实际处理时最多可能会向上取到最近的20的整数倍）（取0则不限制），处理文件保存的文件夹名，多线程爬取处理时线程池的容量（默认为15），是否生成词云图（“True”为是，其它为否，请注意大小写），是否开启debug模式（“Yes”为是，其它为否，请注意大小写）。

	mask.jpg为生成说说内容的词云图时的蒙版图片，如想使用自己的蒙版图片，请注意图片的尺寸最好为1920x1080，白底，对比度尽量高，最佳效果请使用黑白双色图片，jpg格式。

运行项目后，会先加载所需的库和模块以及初始化过程，稍等片刻后即可跳出是否登录的文字询问。
 

若为第一次使用，或据上一次登录已经超过了12小时，请在此输入’y’或’Y’登录。登录时使用webdriver来模拟用户的登录过程，会弹出一个新的浏览器窗口，并在页面顶部有一行“Microsoft Edge 正由自动测试软件控制”的文字说明，等待登录过程结束，若浏览器窗口成功进入空间，则请关注控制台窗口内的文字信息，等待，直到出现三行“＃”构成的标识信息后，浏览器窗口自动关闭，并在控制台窗口内按下回车继续项目的运行。注意在登录过程中控制台窗口内可能会出现大量webdriver运行时的报告信息，一般情况下不用理睬即可，也不要在自动登录过程中干涉或者关闭浏览器窗口以免出现错误。

登录并获取cookies成功后，项目会立刻尝试获取登录QQ的所有好友列表，并将其打印至控制台窗口内，每一个好友的的编号、QQ号以及昵称都会显示出来，注意好友列表的排序顺序为QQ空间内与好友亲密度的排序。这时会跳出是否保存好友列表的信息，建议输入’y’或’Y’同意，这时就会在项目的根目录下创建一个以“QQ号+_friendslist.txt”的文本文件，里面保存有刚刚打印至屏幕上的好友列表信息。
好友列表抓取完成后，这时控制台窗口内就会出现抓取分析的指令说明。

输入给定范围的自然数就会对指定序号好友的空间说说内容进行抓取和分析，分析结果将打印至屏幕上并保存进指定的保存文件夹（默认为“results”）内，结果文件以“QQ号+contents.txt”、“QQ号+analysis.txt”和“QQ号+.png”文件名保存。

输入-1则会对启用线程池对好友列表上的所有好友的说说内容进行抓取和分析，此时分析结果不会打印至屏幕上，只会写入保存至相应文件中。注意如果开启了生成词云图的功能，那么此操作所耗费的时间将会较长，请耐心等待。

输入’c’后则会追加要求输入一个QQ号，这时就会对该输入的QQ号的空间说说内容尝试进行抓取和分析，注意此操作中输入的QQ号可以是好友列表以外的QQ号，如自己的QQ号，但要注意的是，很多用户的QQ空间对非好友为不可访问状态，此时就会抓取失败。

输入’q’则退出程序，结束本项目的运行。


##常见问题


	1,第二次进入程序后没有重新选择自动登录，使用第一次运行时获取得到过的cookies文件可以成功登录，但第三次或者之后再次尝试直接进行爬取操作时就无法正常进行了，同时会说登录失败。这种情况大概率是cookies已经过期失效了，在程序运行后重新再进行一次自动登录操作即可。

	2,自动登录时，弹出浏览器窗口后，一直没有关闭，并且控制台程序也没有明确的文字响应。这种情况下，请检查浏览器窗口的显示界面，查看页面是否正常完整显示，否则请检查网络连接情况。若页面显示正常，请检查页面上是否有密码错误等登录失败的信息，若有则说明配置文件里的登录信息输入有误，请重新输入&保存，再次运行本程序。

	3,爬取到的好友空间内容中很多好友的说说都是空的，很多也只有屈指可数的条目数。这种情况说明该好友可能没有对你开放空间浏览的权限，也有可能是该好友设置其空间说说的显示时间范围仅为最近。

	4,选择爬取好友列表中所有好友的说说内容后，控制台窗口除了几行模型加载完成和字典载入完成的显示外迟迟没有其它的显示内容。这种情况完全正常，出现了下图的文字显示说明已经有分析过程开始，请耐心等待，如果想缩短一些时间，请在运行本程序前修改配置文件，将单个空间最大说说获取条目数上限调低，并尝试关闭生成词云图功能。
 
	5,进入程序后程序冒出了配置文件有误的说明并退出。这种情况请先检查配置文件的内容，如果尝试修改后仍无法正常使用，请先删除配置文件，再次运行本程序，程序会重新创建默认的配置文件。

## 参考

本项目中对于QQ空间说说内容的爬取思路、方法和有关策略的参考和学习主要来源于https://blog.csdn.net/After__today/article/details/81153203
